<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AltTap</title>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="/css/style.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/dark.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/ko.js"></script>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="header-top">
          <h1>
            <i data-lucide="gavel"></i>
            AltTap
          </h1>
          <div class="user-menu">
            <span class="username"
              ><i data-lucide="user"></i> <%= user.username %>님</span
            >
            <button class="logout-button" onclick="logout()">
              <i data-lucide="log-out"></i>
              로그아웃
            </button>
          </div>
        </div>
        <p class="subtitle">실시간 경매로 중고 물품을 거래하세요</p>

        <div class="user-info">
          <div class="user-balance">
            <i data-lucide="wallet"></i>
            <span>잔액:</span>
            <span class="balance-amount" id="userBalance">로딩 중...</span>
          </div>
          <div class="user-balance text-green">
            <i data-lucide="users"></i>
            <span id="onlineUsers">1</span>
            <span>명 접속 중</span>
          </div>
          <button class="add-item-button" onclick="openAddItemModal()">
            <i data-lucide="plus-circle"></i>
            상품 등록
          </button>
        </div>
      </header>

      <!-- 네비게이션 탭 -->
      <div class="nav-tabs">
        <button class="nav-tab active" onclick="switchTab('auction')">
          <i data-lucide="gavel"></i>
          경매
        </button>
        <button class="nav-tab" onclick="switchTab('community')">
          <i data-lucide="message-square"></i>
          커뮤니티
        </button>
        <a href="/admin" class="nav-tab admin-button hidden" id="adminTab">
          <i data-lucide="shield"></i>
          관리자
        </a>
      </div>

      <!-- 경매 탭 -->
      <div id="auctionTab" class="tab-content" style="display: block">
        <div id="itemsContainer" class="items-grid">
          <div class="loading">
            <i data-lucide="loader"></i>
            경매 상품을 불러오는 중...
          </div>
        </div>
      </div>

      <!-- 커뮤니티 탭 -->
      <div id="communityTab" class="tab-content">
        <button class="add-item-button mb-4" onclick="openPostModal()">
          <i data-lucide="plus"></i>
          게시글 작성
        </button>
        <div id="postsContainer">
          <div class="loading">
            <i data-lucide="loader"></i>
            게시글을 불러오는 중...
          </div>
        </div>
      </div>
    </div>

    <!-- 상품 등록 모달 -->
    <div id="addItemModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">상품 등록</h2>
          <button class="close-button" onclick="closeAddItemModal()">
            <i data-lucide="x"></i>
          </button>
        </div>
        <form id="addItemForm" onsubmit="submitNewItem(event)">
          <div class="form-group">
            <label class="form-label">상품명</label>
            <input type="text" class="form-input" id="itemTitle" required />
          </div>
          <div class="form-group">
            <label class="form-label">상품 설명</label>
            <textarea
              class="form-textarea"
              id="itemDescription"
              required
            ></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">시작 가격 (원)</label>
            <input
              type="number"
              class="form-input"
              id="itemPrice"
              min="1000"
              step="1000"
              required
            />
          </div>
          <div class="form-group">
            <label class="form-label">즉시 구매가 (원, 선택사항)</label>
            <input
              type="number"
              class="form-input"
              id="itemBuyNowPrice"
              min="1000"
              step="1000"
              placeholder="즉시 구매가를 설정하지 않으려면 비워두세요"
            />
            <small class="text-gray mt-1 block"
              >시작 가격보다 높아야 합니다</small
            >
          </div>
          <div class="form-group">
            <label class="form-label">경매 종료 시간</label>
            <div class="date-time-container">
              <div class="date-input-wrapper">
                <input
                  type="text"
                  class="form-input"
                  id="auctionEndDate"
                  placeholder="종료 날짜"
                  required
                />
              </div>
              <div class="time-input-wrapper">
                <input
                  type="text"
                  class="form-input"
                  id="auctionEndTime"
                  placeholder="종료 시간"
                  required
                />
              </div>
            </div>
          </div>
          <button type="submit" class="submit-button">
            <i data-lucide="check"></i>
            등록하기
          </button>
        </form>
      </div>
    </div>

    <!-- 게시글 작성 모달 -->
    <div id="postModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">게시글 작성</h2>
          <button class="close-button" onclick="closePostModal()">
            <i data-lucide="x"></i>
          </button>
        </div>
        <form id="postForm" onsubmit="submitPost(event)">
          <div class="form-group">
            <label class="form-label">제목</label>
            <input type="text" class="form-input" id="postTitle" required />
          </div>
          <div class="form-group">
            <label class="form-label">내용</label>
            <textarea class="form-textarea min-h-200"></textarea>
          </div>
          <div class="form-group" class="form-group flex-center-gap">
            <input type="checkbox" id="postAnonymous" class="checkbox-input" />
            <label for="postAnonymous" class="checkbox-label"
              >익명으로 작성</label
            >
          </div>
          <button type="submit" class="submit-button">
            <i data-lucide="check"></i>
            작성하기
          </button>
        </form>
      </div>
    </div>

    <!-- 게시글 상세 모달 -->
    <div id="postDetailModal" class="modal">
      <div class="modal-content max-w-700">
        <div class="modal-header">
          <h2 class="modal-title" id="detailPostTitle"></h2>
          <button class="close-button" onclick="closePostDetailModal()">
            <i data-lucide="x"></i>
          </button>
        </div>
        <div id="postDetailContent"></div>
      </div>
    </div>

    <!-- 알림 -->
    <div id="notification" class="notification">
      <i data-lucide="check-circle"></i>
      <span id="notificationMessage"></span>
    </div>

    <script>
      window.APP_DATA = {
        userId: <%= user.id %>,
        username: "<%= user.username %>",
      };
    </script>
    <script src="/js/main.js"></script>
  </body>
</html>
